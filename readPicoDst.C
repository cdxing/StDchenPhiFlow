
#include <TSystem>

class StMaker;
class StChain;
class StPicoEvent;
class StPicoDstMaker;
class StRefMultCorr;


StChain *chain;
void readPicoDst(const Char_t *inputFile="test.list", char* outputFile="test")
{
    Int_t nEvents = 10000000;
    //Load all the System libraries

    gROOT->LoadMacro("$STAR/StRoot/StMuDSTMaker/COMMON/macros/loadSharedLibraries.C");
    loadSharedLibraries();

    gSystem->Load("StRefMultCorr");
    gSystem->Load("StPicoEvent");
    gSystem->Load("StPicoDstMaker");
    gSystem->Load("StAlexPhiMesonEvent");
    gSystem->Load("StTriFlowMaker");
    chain = new StChain();

    StPicoDstMaker *picoMaker = new StPicoDstMaker(2,inputFile,"picoDst");

    StTriFlowMaker *phitree = new StTriFlowMaker("phitree",picoMaker,outputFile);

    chain->Init();
    cout<<"chain->Init();"<<endl;
    int total = picoMaker->chain()->GetEntries();
    cout << "ok !     "  << endl;
    cout << " Total entries = " << total << endl;
    gRandom = new TRandom3(0);
    if(nEvents>total) nEvents = total;
    for (Int_t i=0; i<nEvents; i++)
    {
        if(i != 0 && i%50 == 0)
        {
            cout << "." << flush;
        }
        if(i != 0 && i%500 == 0)
        {
            Float_t event_percent = 100.0*i/nEvents;
            cout << " " << i << "(" << event_percent << "%)" << "\n" << " ==> Processing data " << flush;
        }

        chain->Clear();
        int iret = chain->Make(i);

        if (iret)
        {
            cout << "Bad return code!" << iret << endl;
            break;
        }

        total++;

    }

    cout << "." << flush;
    cout << " " << nEvents << "(" << 100 << "%)";
    cout << endl;
    cout << "****************************************** " << endl;
    cout << "Work done... now its time to close up shop!"<< endl;
    cout << "****************************************** " << endl;
    chain->Finish();
    cout << "****************************************** " << endl;
    cout << "total number of events  " << nEvents << endl;
    cout << "****************************************** " << endl;

    delete chain;


}
